# Catalog Module Refactor Plan (Phase 2)

## 1.1 Type-driven status update helper
- Objective: remove duplication between publish/unpublish while preserving behavior.
- Scope: `mosaical-hololith-backend/src/catalog/catalog.service.ts`.
- Strategy:
  - Add `PRODUCT_STATUS_BY_ACTION` map (publish/unpublish).
  - Add helper `updateProductStatus(tenantId, productId, status)`.
  - Keep `publishProduct`/`unpublishProduct` as thin wrappers.
- Acceptance criteria:
  - Status values unchanged (PUBLISHED/DRAFT).
  - Same select payload returned.
  - 3-indentation rule maintained.
- Rollback:
  - Inline the update calls back into each method.

## 1.2 Controller mapping helper (optional)
- Objective: reduce DTO-to-service mapping duplication.
- Scope: `mosaical-hololith-backend/src/catalog/catalog.controller.ts`.
- Strategy:
  - Add private helper to build product patch and/or payload.
  - Keep route signatures and DTOs unchanged.
- Acceptance criteria:
  - No HTTP contract changes.
  - 3-indentation rule maintained.
- Rollback:
  - Restore inline mappings.

## 1.3 Guard clause and type polish
- Objective: improve readability without changing behavior.
- Scope: `mosaical-hololith-backend/src/catalog/catalog.service.ts`.
- Strategy:
  - Use guard clauses where appropriate to reduce nesting.
  - Avoid new `any` or non-null assertions.
- Acceptance criteria:
  - Behavior unchanged, checks preserved.
- Rollback:
  - Revert to previous structure.

## Global acceptance criteria
- Public routes and DTO shapes unchanged.
- Tenant scoping and publish visibility preserved.
- 3-indentation rule applied in all touched blocks.
- Duplication reduced where safe.
